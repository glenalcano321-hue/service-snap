<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Book a Provider</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #0f172a; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; }
    .container { max-width: 400px; margin: 40px auto 0 auto; background: #fff; border-radius: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); padding: 32px 24px 28px 24px; }
    .header { text-align: center; margin-bottom: 32px; }
    .service-title { font-size: 1.5em; font-weight: bold; }
    .provider-info { text-align: center; margin-bottom: 32px; }
    .provider-avatar { width: 68px; height: 68px; border-radius: 50%; background: #d1fae5; color: #065f46; display: flex; align-items: center; justify-content: center; font-size: 2.2em; margin: 0 auto 16px auto; }
    .provider-name { font-weight: bold; font-size: 1.17em; margin-bottom: 4px; }
    .provider-meta { color: #9ca3af; margin-bottom: 8px; }
    form label { display: block; margin-bottom: 6px; color: #5b647a; font-weight: 500; }
    input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; background: #f3f4f6; color: #23272d; font-size: 1em; margin-bottom: 16px; box-sizing: border-box; outline: none; transition: border-color 0.18s; }
    input:focus, select:focus { border-color: #38bdf8; }
    .room-selector { display: flex; gap: 12px; margin-bottom: 12px; }
    .room-btn { flex: 1; border-radius: 7px; border: 1.5px solid #cbd5e1; background: #f1f5f9; padding: 9px 0; text-align: center; cursor: pointer; font-weight: 500; }
    .room-btn.selected { background: #bae6fd; color: #1e293b; border: 2px solid #38bdf8; font-weight: bold; }
    .confirm-btn { background: #38bdf8; color: #fff; font-size: 1.08em; width: 100%; padding: 14px; border: none; border-radius: 11px; cursor: pointer; margin-top: 10px; font-weight: bold; letter-spacing: .5px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .info-msg { margin-top: 10px; color: #38bdf8; text-align: center; font-size: 1.09rem; }
    .service-extra-info { margin-bottom: 16px; color: #5b647a; }
  </style>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="container">
    <button 
    onclick="window.location.href='feed.html';"
    style="background:#e0e7ef;border:none;color:#1e293b;padding:9px 18px;border-radius:8px;cursor:pointer;font-weight:600;margin-bottom:18px;display:block;">
    Back to Providers
    </button>
    <div class="header">
      <div class="service-title">Book a Provider</div>
    </div>
    <div class="provider-info">
      <div class="provider-avatar" id="avatar">SP</div>
      <div class="provider-name" id="providerName">Service Provider</div>
      <div class="provider-meta" id="providerRate"></div>
      <div style="font-size:0.95em; color:#38bdf8;" id="providerId"></div>
    </div>
    <form id="bookingForm" autocomplete="off">
      <label for="serviceSelect">Service</label>
      <select required id="serviceSelect" name="service">
        <option value="">Select a service</option>
        <!-- dynamically filled -->
      </select>
      <div class="service-extra-info">
        <div><span id="servicePrice"></span></div>
        <div id="serviceDesc"></div>
      </div>
      <label for="date">Date</label>
      <input required type="date" id="date" name="date">
      <label for="time">Time</label>
      <input required type="time" id="time" name="time">
      <label>Number of Rooms</label>
      <div class="room-selector">
        <div class="room-btn" onclick="selectRoom(this)">1</div>
        <div class="room-btn" onclick="selectRoom(this)">2</div>
        <div class="room-btn selected" onclick="selectRoom(this)">3</div>
        <div class="room-btn" onclick="selectRoom(this)">4+</div>
      </div>
      <label for="details">Additional Details</label>
      <input type="text" id="details" name="details" placeholder="Describe your request...">
      <button class="confirm-btn" type="submit">Confirm Booking</button>
    </form>
    <div class="info-msg" id="successMsg"></div>
  </div>
  <script>
    // Hardcoded mock provider data
    const mockProviders = {
      "1": { name: "Maria Santos", avatar: "M.S.", rate: 200 },
      "2": { name: "Ana Rodriguez", avatar: "A.R.", rate: 250 },
      "3": { name: "Carmen dela Cruz", avatar: "C.d.C.", rate: 300 },
      "4": { name: "Jessica Reyes", avatar: "J.R.", rate: 250 },
      "5": { name: "Patricia Lim", avatar: "P.L.", rate: 300},
      "6": { name: "Grace Martinez", avatar: "G.M.", rate: 280},
      "7": { name: "Chef Marco Silva", avatar: "C.M.S.", rate: 500},
      "8": { name: "Roberto Santos", avatar: "R.S.", rate: 450},
      '9': { name: "Jose Mendoza", avatar: "J.M.", rate: 400},
      "10": { name: "Antonio Verde", avatar: "A.V.", rate: 320}
      
    };

    // FIREBASE 
    const firebaseConfig = {
      apiKey: "AIzaSyDBOmdxfRixu9DGdCEf4HD2DCxbHX2LNNU",
      authDomain: "finding-service-auth.firebaseapp.com",
      projectId: "finding-service-auth",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Get providerId from URL
    const urlParams = new URLSearchParams(window.location.search);
    const providerId = urlParams.get('providerId');

    // Fetch provider info from Firebase or fallback to mock
    db.collection("serviceProviders").doc(providerId).get().then(doc => {
      let data;
      if (doc.exists) {
        data = doc.data();
      } else if (mockProviders[providerId]) {
        data = mockProviders[providerId];
      } else {
        data = { name: "Service Provider", avatar: "SP", rate: "" };
      }
      document.getElementById('providerName').textContent = data.name;
      document.getElementById('avatar').textContent = data.avatar;
      document.getElementById('providerRate').textContent = data.rate ? "Hourly Rate: ₱" + data.rate : '';
      document.getElementById('providerId').textContent = "ID: " + providerId;
    });

    // Hardcoded mock services for each provider
    const mockServices = {
      "1": [
        { id: "svc1", title: "House Cleaning",},
        { id: "svc2", title: "Deep cleaning services",},
        { id: "svc3", title: "Post-construction cleanup",},
        { id: "svc4", title: "Move-in/move-out cleaning",},
        { id: "svc5", title: "Window and glass cleaning",},
        { id: "svc6", title: "Kitchen and bathroom sanitization",},
      ],
      "2": [
        { id: "svc7", title: "Apartment cleaning", },
        { id: "svc8", title: "Small office cleaning", },
        { id: "svc9", title: "Weekly maintenance", },
        { id: "svc10", title: "One-time deep clean", },
        { id: "svc11", title: "Eco-friendly cleaning options", },
      ],
      "3": [
        { id: "svc12", title: "Gardening",}, // tiwasonon ni nga part
        { id: "svc13", title: "Allergy-safe cleaning",},
        { id: "svc14", title: "Pet-friendly cleaning",},
        { id: "svc15", title: "Natural product cleaning",},
        { id: "svc16", title: "Chemical-free sanitization",},
        { id: "svc17", title: "Green deep cleaning",},
      ],
    };

    // Fetch active services for this provider
    db.collection("services")
      .where("providerId", "==", providerId)
      .where("status", "==", "active")
      .get()
      .then(snapshot => {
        let serviceSelect = document.getElementById('serviceSelect');
        if (!snapshot.empty) {
          snapshot.forEach(doc => {
            let service = doc.data();
            let option = document.createElement('option');
            option.value = doc.id;
            option.text = `${service.title} — ₱${service.dailyRate}/day`;
            option.setAttribute('data-price', service.dailyRate);
            option.setAttribute('data-desc', service.description || "");
            serviceSelect.appendChild(option);
          });
        } else if (mockServices[providerId]) {
          mockServices[providerId].forEach(service => {
            let option = document.createElement('option');
            option.value = service.id;
            option.text = `${service.title} — ₱${service.dailyRate}/day`;
            option.setAttribute('data-price', service.dailyRate);
            option.setAttribute('data-desc', service.description || "");
            serviceSelect.appendChild(option);
          });
        }
      });

    // Update UI when a service is chosen
    document.getElementById('serviceSelect').addEventListener('change', function() {
      let selected = this.options[this.selectedIndex];
      document.getElementById('servicePrice').textContent = selected.value
        ? selected.text.split('—')[1] || "" : "";
      document.getElementById('serviceDesc').textContent = selected.getAttribute('data-desc') || "";
    });

    // Room selector logic
    function selectRoom(btn) {
      document.querySelectorAll('.room-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    }

    // Booking submission logic (demo)
    document.getElementById('bookingForm').addEventListener('submit', function(e){
      e.preventDefault();
      document.getElementById('successMsg').textContent = "Booking confirmed! Your appointment has been scheduled.";
      setTimeout(() => {
        document.getElementById('successMsg').textContent = "";
      }, 1600);
    });
  </script>
</body>
</html>
